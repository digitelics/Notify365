<section class="hidden overflow-x-hidden overflow-y-auto fixed inset-0 z-50 outline-none focus:outline-none justify-center items-center" id="modal-edit_user">
  <form action="{% url 'edit-user' user.id %}" method="POST" id="myFormEdit" class="modal-position" enctype="multipart/form-data">
    {% csrf_token %}
    <div class="shadow sm:overflow-hidden sm:rounded-md">
      <div class="bg-white">
        <div class="flex items-center justify-between p-4 bg-purple-50 bg-opacity-50 md:p-5 border-b rounded-t dark:border-gray-600">
          <div>
            <h2 id="payment-details-heading" class="text-lg font-medium leading-6 text-gray-900">Update user</h2>
            <p class="mt-1 text-sm text-gray-500"></p>
          </div>
          <button type="button" onclick="toggleModal('modal-edit_user')" class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white" data-modal-hide="default-modal">
            <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
              <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/>
            </svg>
            <span class="sr-only">Close modal</span>
          </button>
        </div>

        <div class="mt-6 px-10 pb-5 grid grid-cols-4 gap-y-3 gap-x-6">
          <div class="col-span-8 sm:col-span-4">
            <label for="name" class="block text-sm font-medium leading-6 text-gray-900">Full name</label>
            <input type="text" name="name" id="full-name-edit" autocomplete="cc-given-name" tabindex="1" class="mt-2 align-input block w-full rounded-md border-0 px-3 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-gray-900 sm:text-sm sm:leading-6">
            <span class="error-message"></span>

          <div class="col-span-8 sm:col-span-4">
            <label for="phone" class="block text-sm font-medium leading-6 text-gray-900">Phone</label>
            <input type="text" name="phone" id="phone-edit" max="10" tabindex="2" autocomplete="cc-given-tel" class="mt-2 block w-full align-input rounded-md border-0 px-3 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-gray-900 sm:text-sm sm:leading-6">
            <span class="error-message"></span>
          </div>

          <div class="col-span-8 sm:col-span-4">
            <label for="email" class="block text-sm font-medium leading-6 text-gray-900">Email</label>
            <input type="email" name="email" id="email-edit" tabindex="3" autocomplete="cc-given-email" class="mt-2 block w-full align-input rounded-md border-0 px-3 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-gray-900 sm:text-sm sm:leading-6">
            <span class="error-message"></span>
          </div>

          <div class="col-span-8 sm:col-span-4">
            <label for="avatar" class="block text-sm font-medium leading-6 text-gray-900">Profile Picture</label>
            <input type="file" id="avatar-edit" name="avatar" tabindex="6" class="mt-2 block w-full rounded-md border-0 px-3 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-gray-900 sm:text-sm sm:leading-6">
            <span class="error-message"></span>
          </div>
        </div> 
      </div>
      <div class="bg-gray-50 px-4 py-3 text-right sm:px-6">
        <button type="submit" class="inline-flex justify-center rounded-md bg-gray-900 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-gray-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-gray-900">Update</button>
      </div>
    </div>
  </form>
</section>

<div class="hidden opacity-25 fixed inset-0 z-40 bg-black" id="modal-edit_user-backdrop"></div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
      const form = document.getElementById('myFormEdit');
      const nameInputEdit = document.getElementById('full-name-edit');
      const emailInputEdit = document.getElementById('email-edit');
      const avatarInputEdit = document.getElementById('avatar-edit');
      const phoneInputEdit = document.getElementById('phone-edit');

      // Phone validation
      phoneInputEdit.addEventListener('keypress', function (event) {
        if (event.which < 48 || event.which > 57 || this.value.length === 10) {
          event.preventDefault();
        }
      });

      form.addEventListener('submit', function (event) {
        // Prevent the form from submitting
        event.preventDefault();

        // Reset previous error messages
        resetErrorMessages();

        // Validate all fields
        let isValid = true;

        if (!nameInputEdit.value.trim()) {
          setErrorFor(nameInputEdit, 'Full name cannot be blank');
          isValid = false;
        } else if (nameInputEdit.value.trim().length > 100) {
          setErrorFor(nameInputEdit, 'Full name cannot exceed 100 characters');
          isValid = false;
        }

        if (!emailInputEdit.value.trim()) {
          setErrorFor(emailInputEdit, 'Email cannot be blank');
          isValid = false;
        } else if (!isValidEmail(emailInputEdit.value.trim())) {
          setErrorFor(emailInputEdit, 'Invalid email format');
          isValid = false;
        } else if (emailInputEdit.value.trim().length > 100) {
          setErrorFor(emailInputEdit, 'Email cannot exceed 100 characters');
          isValid = false;
        }

        if (!phoneInputEdit.value.trim()) {
          setErrorFor(phoneInputEdit, 'Phone number cannot be blank');
          isValid = false;
        }

        if (avatarInputEdit.files.length > 0) {
          const fileSize = avatarInputEdit.files[0].size; // in bytes
          if (fileSize > 2 * 1024 * 1024) { // 2 MB in bytes
            setErrorFor(avatarInputEdit, 'Profile picture size cannot exceed 2MB');
            isValid = false;
          }
        }

        if (isValid) {
          // Show loading indicator
          document.getElementById('loadingIndicator').classList.remove('hidden');

          // Close modal
          toggleModal('modal-edit_user');

          // Submit the form
          form.submit();
        }
      });

      // Function to set error message for a field
      function setErrorFor(input, message) {
        const formControl = input.parentElement;
        const errorMessage = formControl.querySelector('.error-message');
        errorMessage.textContent = message;
        input.classList.add('error');
      }

      // Function to reset all error messages
      function resetErrorMessages() {
        const errorMessages = document.querySelectorAll('.error-message');
        errorMessages.forEach(function (errorMessage) {
          errorMessage.textContent = '';
        });

        const errorInputs = document.querySelectorAll('.error');
        errorInputs.forEach(function (input) {
          input.classList.remove('error');
        });
      }

      // Function to check if an email is valid
      function isValidEmail(email) {
        const re = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/;
        return re.test(email);
      }
    });
</script>

