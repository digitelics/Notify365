{% extends "layouts/base.html" %}
{% block title %}Customers{% endblock %}
{% block content %}
{% load static %}
<main class="z-0 flex-1 overflow-y-auto focus:outline-none xl:order-last">
   {% include "customers/customer_detail.html" %}

    <!-- TAB TIMELINE -->
    <div class="tabcontent xl:pl-96" id="timeline">
      <article class="border-l border-gray-200 min-height-1000">
        <div class=" mx-auto max-w-5xl px-4 sm:px-6 lg:px-8 content-center"> 
          <div class="flow-root w-timeline">
            <div class="my-8">
              <h1 class="text-lg font-medium leading-6 text-gray-900">Customer timeline</h1>
              <p class="mt-1 text-sm text-gray-500">All actions performed on the platform related to the current client..</p>
            </div>
            <ul role="list" class="-mb-8 my-5">
              <li>
                <div class="relative pb-8">
                  <span class="absolute left-4 top-4 -ml-px h-full w-0.5 bg-gray-200" aria-hidden="true"></span>
                  <div class="relative flex space-x-3">
                    <div>
                      <span class="h-8 w-8 rounded-full bg-gray-400 flex items-center justify-center ring-8 ring-white">
                        <svg class="h-5 w-5 text-white" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                          <path d="M10 8a3 3 0 100-6 3 3 0 000 6zM3.465 14.493a1.23 1.23 0 00.41 1.412A9.957 9.957 0 0010 18c2.31 0 4.438-.784 6.131-2.1.43-.333.604-.903.408-1.41a7.002 7.002 0 00-13.074.003z" />
                        </svg>
                      </span>
                    </div>
                    <div class="flex min-w-0 flex-1 justify-between space-x-4 pt-1.5">
                      <div>
                        <p class="text-sm text-gray-500">Applied to <a href="#" class="font-medium text-gray-900">Front End Developer</a></p>
                      </div>
                      <div class="whitespace-nowrap text-right text-sm text-gray-500">
                        <time datetime="2020-09-20">Sep 20</time>
                      </div>
                    </div>
                  </div>
                </div>
              </li>
              <li>
                <div class="relative pb-8">
                  <span class="absolute left-4 top-4 -ml-px h-full w-0.5 bg-gray-200" aria-hidden="true"></span>
                  <div class="relative flex space-x-3">
                    <div>
                      <span class="h-8 w-8 rounded-full bg-blue-500 flex items-center justify-center ring-8 ring-white">
                        <svg class="h-5 w-5 text-white" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                          <path d="M1 8.25a1.25 1.25 0 112.5 0v7.5a1.25 1.25 0 11-2.5 0v-7.5zM11 3V1.7c0-.268.14-.526.395-.607A2 2 0 0114 3c0 .995-.182 1.948-.514 2.826-.204.54.166 1.174.744 1.174h2.52c1.243 0 2.261 1.01 2.146 2.247a23.864 23.864 0 01-1.341 5.974C17.153 16.323 16.072 17 14.9 17h-3.192a3 3 0 01-1.341-.317l-2.734-1.366A3 3 0 006.292 15H5V8h.963c.685 0 1.258-.483 1.612-1.068a4.011 4.011 0 012.166-1.73c.432-.143.853-.386 1.011-.814.16-.432.248-.9.248-1.388z" />
                        </svg>
                      </span>
                    </div>
                    <div class="flex min-w-0 flex-1 justify-between space-x-4 pt-1.5">
                      <div>
                        <p class="text-sm text-gray-500">Advanced to phone screening by <a href="#" class="font-medium text-gray-900">Bethany Blake</a></p>
                      </div>
                      <div class="whitespace-nowrap text-right text-sm text-gray-500">
                        <time datetime="2020-09-22">Sep 22</time>
                      </div>
                    </div>
                  </div>
                </div>
              </li>
              <li>
                <div class="relative pb-8">
                  <span class="absolute left-4 top-4 -ml-px h-full w-0.5 bg-gray-200" aria-hidden="true"></span>
                  <div class="relative flex space-x-3">
                    <div>
                      <span class="h-8 w-8 rounded-full bg-green-500 flex items-center justify-center ring-8 ring-white">
                        <svg class="h-5 w-5 text-white" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                          <path fill-rule="evenodd" d="M16.704 4.153a.75.75 0 01.143 1.052l-8 10.5a.75.75 0 01-1.127.075l-4.5-4.5a.75.75 0 011.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 011.05-.143z" clip-rule="evenodd" />
                        </svg>
                      </span>
                    </div>
                    <div class="flex min-w-0 flex-1 justify-between space-x-4 pt-1.5">
                      <div>
                        <p class="text-sm text-gray-500">Completed phone screening with <a href="#" class="font-medium text-gray-900">Martha Gardner</a></p>
                      </div>
                      <div class="whitespace-nowrap text-right text-sm text-gray-500">
                        <time datetime="2020-09-28">Sep 28</time>
                      </div>
                    </div>
                  </div>
                </div>
              </li>
              <li>
                <div class="relative pb-8">
                  <span class="absolute left-4 top-4 -ml-px h-full w-0.5 bg-gray-200" aria-hidden="true"></span>
                  <div class="relative flex space-x-3">
                    <div>
                      <span class="h-8 w-8 rounded-full bg-blue-500 flex items-center justify-center ring-8 ring-white">
                        <svg class="h-5 w-5 text-white" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                          <path d="M1 8.25a1.25 1.25 0 112.5 0v7.5a1.25 1.25 0 11-2.5 0v-7.5zM11 3V1.7c0-.268.14-.526.395-.607A2 2 0 0114 3c0 .995-.182 1.948-.514 2.826-.204.54.166 1.174.744 1.174h2.52c1.243 0 2.261 1.01 2.146 2.247a23.864 23.864 0 01-1.341 5.974C17.153 16.323 16.072 17 14.9 17h-3.192a3 3 0 01-1.341-.317l-2.734-1.366A3 3 0 006.292 15H5V8h.963c.685 0 1.258-.483 1.612-1.068a4.011 4.011 0 012.166-1.73c.432-.143.853-.386 1.011-.814.16-.432.248-.9.248-1.388z" />
                        </svg>
                      </span>
                    </div>
                    <div class="flex min-w-0 flex-1 justify-between space-x-4 pt-1.5">
                      <div>
                        <p class="text-sm text-gray-500">Advanced to interview by <a href="#" class="font-medium text-gray-900">Bethany Blake</a></p>
                      </div>
                      <div class="whitespace-nowrap text-right text-sm text-gray-500">
                        <time datetime="2020-09-30">Sep 30</time>
                      </div>
                    </div>
                  </div>
                </div>
              </li>
              <li>
                <div class="relative pb-8">
                  <div class="relative flex space-x-3">
                    <div>
                      <span class="h-8 w-8 rounded-full bg-green-500 flex items-center justify-center ring-8 ring-white">
                        <svg class="h-5 w-5 text-white" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                          <path fill-rule="evenodd" d="M16.704 4.153a.75.75 0 01.143 1.052l-8 10.5a.75.75 0 01-1.127.075l-4.5-4.5a.75.75 0 011.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 011.05-.143z" clip-rule="evenodd" />
                        </svg>
                      </span>
                    </div>
                    <div class="flex min-w-0 flex-1 justify-between space-x-4 pt-1.5">
                      <div>
                        <p class="text-sm text-gray-500">Completed interview with <a href="#" class="font-medium text-gray-900">Katherine Snyder</a></p>
                      </div>
                      <div class="whitespace-nowrap text-right text-sm text-gray-500">
                        <time datetime="2020-10-04">Oct 4</time>
                      </div>
                    </div>
                  </div>
                </div>
              </li>
            </ul>
          </div>
        </div>
      </article>
    </div>

     <!-- TAB NOTIFICATION -->
    <div class="tabcontent xl:pl-96" id="notification">
      <article class="border-l border-gray-200 min-height-1000">
        <div class=" mx-auto max-w-5xl px-4 sm:px-6 lg:px-8 content-center"> 
          <div class="my-8">
            <h1 class="text-lg font-medium leading-6 text-gray-900">Customer notifications</h1>
            <p class="mt-1 text-sm text-gray-500">All notifications sent to the current client.</p>
          </div>
          <div class="px-4 sm:px-6 lg:px-8">
            <div class="-mx-4 mt-10 ring-1 ring-gray-300 sm:mx-0 sm:rounded-lg">
              <table class="min-w-full divide-y divide-gray-300">
                <thead>
                  <tr>
                    <th scope="col" width='20' class="py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-6"></th>
                    <th scope="col" width='500' class="py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-6">Message</th>
                    <th scope="col" class="hidden px-3 py-3.5 text-left text-sm font-semibold text-gray-900 lg:table-cell">Date</th>
                    <th scope="col" class="hidden px-3 py-3.5 text-left text-sm font-semibold text-gray-900 lg:table-cell">Sent by</th>
                  </tr>
                </thead>
                {% if data.notifications %}
                   <tbody id="notification-elements"> 
                    {% for notification in data.notifications %}
                      <tr>
                        <td class="hidden py-4 pl-6 pr-3 text-sm text-gray-500 lg:table-cell border-t border-gray-200">       
                        <svg viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6"> 
                         {% if notification.chanel == "text" %}
                             <path fill-rule="evenodd" d="M4.804 21.644A6.707 6.707 0 0 0 6 21.75a6.721 6.721 0 0 0 3.583-1.029c.774.182 1.584.279 2.417.279 5.322 0 9.75-3.97 9.75-9 0-5.03-4.428-9-9.75-9s-9.75 3.97-9.75 9c0 2.409 1.025 4.587 2.674 6.192.232.226.277.428.254.543a3.73 3.73 0 0 1-.814 1.686.75.75 0 0 0 .44 1.223ZM8.25 10.875a1.125 1.125 0 1 0 0 2.25 1.125 1.125 0 0 0 0-2.25ZM10.875 12a1.125 1.125 0 1 1 2.25 0 1.125 1.125 0 0 1-2.25 0Zm4.875-1.125a1.125 1.125 0 1 0 0 2.25 1.125 1.125 0 0 0 0-2.25Z" clip-rule="evenodd" />  
                         {% elif notification.chanel == "email"%}
                            <path d="M1.5 8.67v8.58a3 3 0 0 0 3 3h15a3 3 0 0 0 3-3V8.67l-8.928 5.493a3 3 0 0 1-3.144 0L1.5 8.67Z" />'
                            <path d="M22.5 6.908V6.75a3 3 0 0 0-3-3h-15a3 3 0 0 0-3 3v.158l9.714 5.978a1.5 1.5 0 0 0 1.572 0L22.5 6.908Z" />'
                         {% else%}
                            <path fill-rule="evenodd" d="M1.5 4.5a3 3 0 0 1 3-3h1.372c.86 0 1.61.586 1.819 1.42l1.105 4.423a1.875 1.875 0 0 1-.694 1.955l-1.293.97c-.135.101-.164.249-.126.352a11.285 11.285 0 0 0 6.697 6.697c.103.038.25.009.352-.126l.97-1.293a1.875 1.875 0 0 1 1.955-.694l4.423 1.105c.834.209 1.42.959 1.42 1.82V19.5a3 3 0 0 1-3 3h-2.25C8.552 22.5 1.5 15.448 1.5 6.75V4.5Z" clip-rule="evenodd" />
                         {% endif %}
                        </svg>
                        </td>
                        <td class="hidden px-3 py-3.5 text-sm text-gray-500 lg:table-cell border-t border-gray-200">
                        <div class="font-medium text-gray-900 pl-2">
                        <p>{{ notification.text }}</p>
                        </div>
                        </td>
                        <td class="hidden px-3 py-3.5 text-sm text-gray-500 lg:table-cell border-t border-gray-200">{{ notification.date }}</td>
                        <td class="hidden px-3 py-3.5 text-sm text-gray-500 lg:table-cell border-t border-gray-200">{{ notification.sent_by }}</td>
                      </tr>
                    {% endfor %}
                   </tbody> 
                {% else %}
                  <tbody id="notification-elements"> </tbody>
                {% endif %}
               
              </table>
            </div>
          </div>

        </div>
      </article>
    </div>
</main>
<aside class="fixed inset-y-0 left-72 hidden w-96 overflow-y-auto mt-14 xl:block">
      <div class="px-6 pb-4 pt-6">
        <h2 class="text-lg font-medium text-gray-900">Directory</h2>
        <p class="mt-1 text-sm text-gray-600">Search directory of {{data.customer_count}} customers</p>
        <div class="mt-6 flex gap-x-2" action="#">
          <div class="min-w-0 flex-1">    
            <label for="search-customer" class="sr-only">Search</label>
            <div class="relative rounded-md shadow-sm">
              <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
                <svg class="h-5 w-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                  <path fill-rule="evenodd" d="M9 3.5a5.5 5.5 0 100 11 5.5 5.5 0 000-11zM2 9a7 7 0 1112.452 4.391l3.328 3.329a.75.75 0 11-1.06 1.06l-3.329-3.328A7 7 0 012 9z" clip-rule="evenodd" />
                </svg>
              </div>
              <input type="search" name="search-customer" id="search-customer" class="block w-full rounded-md border-0 py-1.5 pl-10 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-pink-500 sm:text-sm sm:leading-6" placeholder="Search">
            </div>
          </div>
          <button onclick="toggleSlideover()"  class="inline-flex height-fit justify-center hover:text-indigo-600 rounded-md bg-white px-3 py-2 text-gray-400 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50">
            <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
              <path fill-rule="evenodd" d="M2.628 1.601C5.028 1.206 7.49 1 10 1s4.973.206 7.372.601a.75.75 0 01.628.74v2.288a2.25 2.25 0 01-.659 1.59l-4.682 4.683a2.25 2.25 0 00-.659 1.59v3.037c0 .684-.31 1.33-.844 1.757l-1.937 1.55A.75.75 0 018 18.25v-5.757a2.25 2.25 0 00-.659-1.591L2.659 6.22A2.25 2.25 0 012 4.629V2.34a.75.75 0 01.628-.74z" clip-rule="evenodd" />
            </svg>
            <span class="sr-only">Search</span>
          </button>
          <button onclick="toggleModal('modal-customer')" class="inline-flex height-fit justify-center hover:text-indigo-600 rounded-md bg-white px-3 py-2 text-gray-400 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50">
            <svg class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
              <path fill-rule="evenodd" d="M5.25 6.375a4.125 4.125 0 1 1 8.25 0 4.125 4.125 0 0 1-8.25 0ZM2.25 19.125a7.125 7.125 0 0 1 14.25 0v.003l-.001.119a.75.75 0 0 1-.363.63 13.067 13.067 0 0 1-6.761 1.873c-2.472 0-4.786-.684-6.76-1.873a.75.75 0 0 1-.364-.63l-.001-.122ZM18.75 7.5a.75.75 0 0 0-1.5 0v2.25H15a.75.75 0 0 0 0 1.5h2.25v2.25a.75.75 0 0 0 1.5 0v-2.25H21a.75.75 0 0 0 0-1.5h-2.25V7.5Z" clip-rule="evenodd" />
            </svg>
            <span class="sr-only">Search</span>
          </button>
        </div>
      </div>
      <!-- Directory list -->
      <nav class="min-h-0 flex-1 overflow-y-auto" aria-label="Directory">
          {% for letter, customers in data.grouped_customers.items %}
              <div class="relative">
                  <div class="sticky top-0 z-10 border-b border-t border-gray-200 bg-gray-50 px-6 py-1 text-sm font-medium text-gray-500">
                      <h3>{{ letter }}</h3>
                  </div>
                  <ul role="list" class="relative z-0 divide-y divide-gray-200">
                      {% for customer in customers %}
                          <li>
                              <div class="relative flex items-center space-x-3 px-6 py-5 focus-within:ring-2 focus-within:ring-inset focus-within:ring-pink-500 hover:bg-gray-50">
                                  <div class="flex-shrink-0">
                                      <img class="h-10 w-10 rounded-full" src={% static 'images/user-circle-icon.jpeg' %} alt="">
                                  </div>
                                  <div class="min-w-0 flex-1">
                                      <a href="#" class="customer-link" data-id="{{ customer.id }}">
                                          <span class="absolute inset-0" aria-hidden="true"></span>
                                          <p class="text-sm font-medium text-gray-900">{{ customer.first_name }} {{ customer.last_name }}</p>
                                          <p class="truncate text-sm text-gray-500">{{ customer.formatted_phone }}</p>
                                      </a>
                                  </div>
                              </div>
                          </li>
                      {% endfor %}
                  </ul>
              </div>
          {% endfor %}
      </nav>
</aside>
  

 <!-- ADD CUSTOMER MODAL -->
   {% include "customers/add_customer_modal.html" %}

  <!-- CREATE EMAIL MODAL -->
   {% include "customers/new_customer_email_modal.html" %}

  <!-- CREATE TEXT MESSAGE MODAL -->
   {% include "customers/new_customer_text_mesage_modal.html" %}

  <!-- CREATE NEW DEAL MODAL -->
   {% include "customers/new_deal_modal.html" %} 


  <!-- CREATE NEW NOTE MODAL -->
   {% include "customers/new_note_modal.html" %}

  <!-- UPLOAD NEW ATTACHMENTS -->
    {% include "customers/upload_attachment_modal.html" %}
 
      <!-- ADITIONAL CONTACT MODAL -->
   {% include "customers/new_customer_contact.html" %}
 


  <!-- Modal call in progress -->
    {% include 'webcall/call_in_progress_modal.html' %}

   

  <!-- DELETE CUSTOMER CONFIRMATION MODAL -->
  <section class="hidden overflow-x-hidden overflow-y-auto fixed inset-0 z-50 outline-none focus:outline-none justify-center items-center" id="modal-confirmation">
    <form action="#" method="POST" class="modal-position">
      {% csrf_token %}
      <div class="relative z-10" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"></div>
          <div class="fixed inset-0 z-10 w-screen overflow-y-auto">
            <div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">
              <div class="relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg">
                <div class="bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4">
                  <div class="sm:flex sm:items-start">
                    <div class="mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10">
                      <svg class="h-6 w-6 text-red-600" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
                      </svg>
                    </div>
                    <div class="mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left">
                      <h3 class="text-base font-semibold leading-6 text-gray-900" id="modal-title">Delete customer</h3>
                      <div class="mt-2">
                        <p class="text-sm text-gray-500">Are you sure you want to delete this customer? All of your data will be permanently removed. This action cannot be undone.</p>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6">
                  <button type="button" class="inline-flex w-full justify-center rounded-md bg-red-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-red-500 sm:ml-3 sm:w-auto">Delete</button>
                  <button type="button" onclick="toggleModal('modal-confirmation')" class="mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto">Cancel</button>
                </div>
              </div>
            </div>
          </div>
        </div>
    </form>
  </section>
  <div class="hidden opacity-25 fixed inset-0 z-40 bg-black" id="modal-confirmation-backdrop"></div>

  <!-- DELETE CUSTOMER DEAL MODAL -->
  <section class="hidden overflow-x-hidden overflow-y-auto fixed inset-0 z-50 outline-none focus:outline-none justify-center items-center" id="modal-deletedeal">
    <form action="#" method="POST" class="modal-position">
      {% csrf_token %}
      <div class="relative z-10" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"></div>
          <div class="fixed inset-0 z-10 w-screen overflow-y-auto">
            <div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">
              <div class="relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg">
                <div class="bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4">
                  <div class="sm:flex sm:items-start">
                    <div class="mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10">
                      <svg class="h-6 w-6 text-red-600" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
                      </svg>
                    </div>
                    <div class="mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left">
                      <h3 class="text-base font-semibold leading-6 text-gray-900" id="modal-title">Delete Deal</h3>
                      <div class="mt-2">
                        <p class="text-sm text-gray-500">Are you sure you want to delete this <span><b>deal</b></span>? All of your data will be permanently removed. This action cannot be undone.</p>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6">
                  <button type="button" class="inline-flex w-full justify-center rounded-md bg-red-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-red-500 sm:ml-3 sm:w-auto">Delete</button>
                  <button type="button" onclick="toggleModal('modal-deletedeal')" class="mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto">Cancel</button>
                </div>
              </div>
            </div>
          </div>
        </div>
    </form>
  </section>
  <div class="hidden opacity-25 fixed inset-0 z-40 bg-black" id="modal-deletedeal-backdrop"></div>

<!-- DELETE CUSTOMER NOTE MODAL -->
  <section class="hidden overflow-x-hidden overflow-y-auto fixed inset-0 z-50 outline-none focus:outline-none justify-center items-center" id="modal-deletenote">
    <form action="#" method="POST" class="modal-position">
      {% csrf_token %}
      <div class="relative z-10" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"></div>
          <div class="fixed inset-0 z-10 w-screen overflow-y-auto">
            <div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">
              <div class="relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg">
                <div class="bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4">
                  <div class="sm:flex sm:items-start">
                    <div class="mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10">
                      <svg class="h-6 w-6 text-red-600" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
                      </svg>
                    </div>
                    <div class="mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left">
                      <h3 class="text-base font-semibold leading-6 text-gray-900" id="modal-title">Delete note</h3>
                      <div class="mt-2">
                        <p class="text-sm text-gray-500">Are you sure you want to delete this <span><b>note</b></span>? All of your data will be permanently removed. This action cannot be undone.</p>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6">
                  <button type="button" class="inline-flex w-full justify-center rounded-md bg-red-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-red-500 sm:ml-3 sm:w-auto">Delete</button>
                  <button type="button" onclick="toggleModal('modal-deletenote')" class="mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto">Cancel</button>
                </div>
              </div>
            </div>
          </div>
        </div>
    </form>
  </section>
  <div class="hidden opacity-25 fixed inset-0 z-40 bg-black" id="modal-deletenote-backdrop"></div>

  <!-- DELETE CUSTOMER FILE MODAL -->
  <section class="hidden overflow-x-hidden overflow-y-auto fixed inset-0 z-50 outline-none focus:outline-none justify-center items-center" id="modal-deletefile">
    <form action="#" method="POST" class="modal-position">
      {% csrf_token %}
      <div class="relative z-10" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"></div>
          <div class="fixed inset-0 z-10 w-screen overflow-y-auto">
            <div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">
              <div class="relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg">
                <div class="bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4">
                  <div class="sm:flex sm:items-start">
                    <div class="mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10">
                      <svg class="h-6 w-6 text-red-600" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
                      </svg>
                    </div>
                    <div class="mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left">
                      <h3 class="text-base font-semibold leading-6 text-gray-900" id="modal-title">Delete file</h3>
                      <div class="mt-2">
                        <p class="text-sm text-gray-500">Are you sure you want to delete this <span><b>file</b></span>? All of your data will be permanently removed. This action cannot be undone.</p>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6">
                  <button type="button" class="inline-flex w-full justify-center rounded-md bg-red-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-red-500 sm:ml-3 sm:w-auto">Delete</button>
                  <button type="button" onclick="toggleModal('modal-deletefile')" class="mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto">Cancel</button>
                </div>
              </div>
            </div>
          </div>
        </div>
    </form>
  </section>
  <div class="hidden opacity-25 fixed inset-0 z-40 bg-black" id="modal-deletefile-backdrop"></div>

   <!-- CALL CUSTOMER  -->
  <section class="hidden overflow-x-hidden overflow-y-auto fixed inset-0 z-50 outline-none focus:outline-none justify-center items-center" id="modal-callconfirmation">
    <form action="#" method="POST" class="modal-position">
      {% csrf_token %}
      <div class="relative z-10" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"></div>
          <div class="fixed inset-0 z-10 w-screen overflow-y-auto">
            <div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">
              <div class="relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg">
                <div class="bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4">
                  <div class="sm:flex sm:items-start">
                    <div class="mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10">
                      <svg class="h-6 w-6 text-red-600" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
                      </svg>
                    </div>
                    <div class="mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left">
                      <h3 class="text-base font-semibold leading-6 text-gray-900" id="modal-title">Call confirmation</h3>
                      <div class="mt-2">
                        <p class="text-sm text-gray-500">Are you sure you want to call the current customer?</p>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6">
                  <button id="btnCall" type="button" class="inline-flex w-full justify-center rounded-md bg-green-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-green-500 sm:ml-3 sm:w-auto">Call</button>
                  <button type="button" onclick="toggleSimpleModal('modal-callconfirmation')" class="mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto">Cancel</button>
                </div>
              </div>
            </div>
          </div>
        </div>
    </form>
  </section>
 


  
  <!-- SLIDE OVER -->
  {% include "customers/customer_filters_slide_over.html" %}
 

{% endblock %}
{% block script %}
  
    <script>
        $(document).ready(function(){
            $('.customer-link').click(function(e){
                e.preventDefault();
                var customerId = $(this).data('id');

                $.ajax({
                    url: '/customers/' + customerId + '/',
                    method: 'GET',
                    success: function(data){
                        $('#detail-first-name').text(data.first_name);
                        $('#customer-id').text(customerId);
                        $('#detail-last-name').text(data.last_name);
                        $('#detail-phone').text(data.phone);
                        $('#sms-to').val(data.phone);
                        $('#detail-email').text(data.email);
                        $('#detail-street').text(data.street);
                        $('#detail-city').text(data.city+', '+data.state);
                        $('#detail-zip-code').text(data.zip_code);
                        $('#detail-dob').text(data.dob);
                        $('#detail-customer-status').text(data.customer_status);
                        $('#detail-gender').text(data.gender);
                        $('#customerPhoneNumber').val(data.phone);
                        $('#detail-created-by').text(data.created_by);
                        $('#detail-last-change').text(data.last_change);
                        $('#customer-age').text(calcularEdad(data.dob));
                        $('#customer-detail-none').addClass('hidden');
                        $('#customer-details').removeClass('hidden');

                        $('#delas-elements').empty();
                        data.deals.forEach(function(deal) {
                          var dealElement = '<tr>';
                          var deactivationDate = new Date(deal.deactivation_date);
                          // Obtener la fecha actual sin la parte de tiempo
                          var today = new Date();
                          today.setHours(0, 0, 0, 0);
                          var date = new Date(deal.deactivation_date);
                          var options = { year: 'numeric', month: 'short', day: 'numeric' };
                          var formattedDate = date.toLocaleDateString('en-US', options);
                          if (deactivationDate >= today)
                          {
                            dealElement += '<td class="whitespace-nowrap py-4 pl-4 pr-3 text-sm font-medium text-blue-500 sm:pl-6">' + deal.code + '</td>';
                            dealElement += '<td class="whitespace-nowrap px-3 py-4 text-sm text-blue-500">' + deal.product_name + '</td>';
                            dealElement += '<td class="whitespace-nowrap px-3 py-4 text-sm text-blue-500">' + deal.base_premium + '</td>';
                            dealElement += '<td class="whitespace-nowrap px-3 py-4 text-sm text-blue-500">' + formattedDate + '</td>';
                            dealElement += '<td class="whitespace-nowrap py-4 pl-3 pr-4 text-right text-sm font-medium sm:pr-6">';
                            dealElement += '<div class="flex flex-1 gap-2 justify-end">';
                            dealElement += '<a href="#customer-deal-block" onclick="toggleModal("modal-deal")"  title="Edit"><span title="Edit deal">';
                            dealElement += '<svg fill="none" viewBox="0 0 26 26" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 text-green-500 hover:text-green-300">';
                            dealElement += '<path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L6.832 19.82a4.5 4.5 0 0 1-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 0 1 1.13-1.897L16.863 4.487Zm0 0L19.5 7.125" />';
                            dealElement += '</svg></span>';
                            dealElement += '</a>';
                            dealElement += '<a href="#customer-deal-block" title="Cancel"><span title="Cancel deal">';
                            dealElement += '<svg fill="none" viewBox="0 0 26 26" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 text-orange-600 hover:text-orange-400">';
                            dealElement += '<path stroke-linecap="round" stroke-linejoin="round" d="m20.25 7.5-.625 10.632a2.25 2.25 0 0 1-2.247 2.118H6.622a2.25 2.25 0 0 1-2.247-2.118L3.75 7.5m6 4.125 2.25 2.25m0 0 2.25 2.25M12 13.875l2.25-2.25M12 13.875l-2.25 2.25M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125Z" />';
                            dealElement += '</svg></span>';
                            dealElement += '</a>';
                            dealElement += '<a href="#customer-deal-block" title="Delete" onclick="toggleModal("modal-deletedeal")"><span title="Remove deal">';
                            dealElement += '<svg fill="none" viewBox="0 0 26 26" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 text-red-600 hover:text-red-400">';
                            dealElement += '<path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" />';
                            dealElement += '</svg></span>';
                            dealElement += '</a>';
                            dealElement += '</div>';
                            dealElement += '</td>';
                          } else {
                            dealElement += '<td class="whitespace-nowrap py-4 pl-4 pr-3 text-sm font-medium text-gray-500 sm:pl-6">' + deal.code + '</td>';
                            dealElement += '<td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500">' + deal.product_name + '</td>';
                            dealElement += '<td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500">' + deal.base_premium + '</td>';
                            dealElement += '<td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500">' + deal.deactivation_date + '</td>';
                            dealElement += '<td class="whitespace-nowrap py-4 pl-3 pr-4 text-right text-sm font-medium sm:pr-6">';
                            dealElement += '<div class="flex flex-1 gap-2 justify-end">';
                            dealElement += '<span><span title="Edit deal">';
                            dealElement += '<svg fill="none" viewBox="0 0 26 26" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 text-gray-400">';
                            dealElement += '<path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L6.832 19.82a4.5 4.5 0 0 1-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 0 1 1.13-1.897L16.863 4.487Zm0 0L19.5 7.125" />';
                            dealElement += '</svg></span>';
                            dealElement += '</span>';
                            dealElement += '<span><span title="Cancel deal">';
                            dealElement += '<svg fill="none" viewBox="0 0 26 26" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 text-gray-600">';
                            dealElement += '<path stroke-linecap="round" stroke-linejoin="round" d="m20.25 7.5-.625 10.632a2.25 2.25 0 0 1-2.247 2.118H6.622a2.25 2.25 0 0 1-2.247-2.118L3.75 7.5m6 4.125 2.25 2.25m0 0 2.25 2.25M12 13.875l2.25-2.25M12 13.875l-2.25 2.25M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125Z" />';
                            dealElement += '</svg></span>';
                            dealElement += '</span>';
                            dealElement += '<a href="#customer-deal-block" title="Delete" onclick="toggleModal("modal-deletedeal")"><span title="Remove deal">';
                            dealElement += '<svg fill="none" viewBox="0 0 26 26" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 text-red-600 hover:text-red-400">';
                            dealElement += '<path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" />';
                            dealElement += '</svg></span>';
                            dealElement += '</a>';
                            dealElement += '</div>';
                            dealElement += '</td>';
                          }
                           dealElement += '</tr>';
                           $('#delas-elements').append(dealElement);
                        });

                        
                       
                        $('#notes_elements').empty();
                        data.notes.forEach(function(note) {
                          var noteElement = '<tr>';
                          var date = new Date(note.date);
                          var options = { year: 'numeric', month: 'short', day: 'numeric' };
                          var formattedDate = date.toLocaleDateString('en-US', options);

                          noteElement += '<td class="py-4 pl-4 pr-3 text-sm font-medium text-gray-500 sm:pl-6">' + note.note + '</td>';
                          noteElement += '<td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500">' + formattedDate + '</td>';
                          noteElement += '<td class="px-3 py-4 text-sm text-gray-500">' + note.created_by_name + '</td>';
                          noteElement += '<td class="whitespace-nowrap py-4 pl-3 pr-4 text-right text-sm font-medium sm:pr-6">';
                          noteElement += '<div class="flex flex-1 gap-2 justify-end">';
                          noteElement += '<a href="#customer-deal-block" onclick="toggleModal("modal-deal")"  title="Edit"><span title="Edit deal">';
                          noteElement += '<svg fill="none" viewBox="0 0 26 26" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 text-green-500 hover:text-green-300">';
                          noteElement += '<path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L6.832 19.82a4.5 4.5 0 0 1-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 0 1 1.13-1.897L16.863 4.487Zm0 0L19.5 7.125" />';
                          noteElement += '</svg></span>';
                          noteElement += '</a>';
                          noteElement += '<a href="#customer-deal-block" title="Delete" onclick="toggleModal("modal-deletedeal")"><span title="Remove deal">';
                          noteElement += '<svg fill="none" viewBox="0 0 26 26" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 text-red-600 hover:text-red-400">';
                          noteElement += '<path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" />';
                          noteElement += '</svg></span>';
                          noteElement += '</a>';
                          noteElement += '</div>';
                          noteElement += '</td>';
                          noteElement += '</tr>';
                          $('#notes_elements').append(noteElement);
                          
                        });

                        $('#document-elements').empty();
                        data.documents.forEach(function(document) {
                          var documentElement = '<tr>';
                          var date = new Date(document.updated_at);
                          var options = { year: 'numeric', month: 'short', day: 'numeric' };
                          var formattedDate = date.toLocaleDateString('en-US', options);
                          if (document.doc_path)
                          {
                            documentElement += '<td class="py-4 pl-4 pr-3 text-sm font-medium text-gray-500 sm:pl-6">' 
                            documentElement +=      '<div class="flex flex-1 gap-x-2">'   
                            documentElement +=          '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">'
                            documentElement +=              '<path stroke-linecap="round" stroke-linejoin="round" d="m18.375 12.739-7.693 7.693a4.5 4.5 0 0 1-6.364-6.364l10.94-10.94A3 3 0 1 1 19.5 7.372L8.552 18.32m.009-.01-.01.01m5.699-9.941-7.81 7.81a1.5 1.5 0 0 0 2.112 2.13" />'
                            documentElement +=          '</svg>'
                            documentElement +=          '<span>' + document.document_name + '</span>'
                            documentElement +=      '</div>'
                            documentElement += '</td>'
                            documentElement += '<td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500">' + formattedDate + '</td>';
                            documentElement += '<td class="whitespace-nowrap px-3 py-4 text-sm text-blue-500">' + document.created_by_name + '</td>';
                            documentElement += '<td class="whitespace-nowrap py-4 pl-3 pr-4 text-right text-sm font-medium sm:pr-6">';
                            documentElement += '<div class="flex flex-1 gap-2 justify-end">';
                            documentElement += '<a href=' + data.base_url + document.doc_path +'  title="download"><span title="Download">';
                            documentElement += '<svg fill="none" viewBox="0 0 26 26" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 text-indigo-600 hover:text-indigo-400">';
                            documentElement += '<path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3" />';
                            documentElement += '</svg>';
                            documentElement += '</a>';
                            documentElement += '<a href="#customer-attach-block" title="Delete" onclick="toggleModal("modal-deletefile")"><span title="Remove file">';
                            documentElement += '<svg fill="none" viewBox="0 0 26 26" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 text-red-600 hover:text-red-400">';
                            documentElement += '<path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" />';
                            documentElement += '</svg>';
                            documentElement += '</a>';
                            documentElement += '</div>';
                            documentElement += '</td>';
                          } else {
                            documentElement += '<td class="py-4 pl-4 pr-3 text-sm font-medium text-gray-500 sm:pl-6">' 
                            documentElement +=      '<div class="flex flex-1 gap-x-2">'   
                            documentElement +=          '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">'
                            documentElement +=              '<path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m6.75 12-3-3m0 0-3 3m3-3v6m-1.5-15H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z" />'
                            documentElement +=          '</svg>'
                            documentElement +=          '<span>' + document.document_name + '</span>'
                            documentElement +=      '</div>'
                            documentElement += '</td>'
                            documentElement += '<td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500">' + formattedDate + '</td>';
                            documentElement += '<td class="whitespace-nowrap px-3 py-4 text-sm text-red-500">' + (document.created_by_name ? document.created_by_name : "Pending") + '</td>';
                            documentElement += '<td class="whitespace-nowrap py-4 pl-3 pr-4 text-right text-sm font-medium sm:pr-6">';
                            documentElement += '<div class="flex flex-1 gap-2 justify-end">';
                            documentElement += '<span>';
                            documentElement += '<svg fill="none" viewBox="0 0 26 26" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 text-indigo-600 hover:text-indigo-400">';
                            documentElement += '<path stroke-linecap="round" stroke-linejoin="round" d="" />';
                            documentElement += '</svg>';
                            documentElement += '</span>';
                            
                            documentElement += '</div>';
                            documentElement += '</td>';
                          }
                           documentElement += '</tr>';
                           $('#document-elements').append(documentElement);
                        });

                        var customerDetailUrl = "{% url 'customer_detail' 0 %}".slice(0, -2);
                        $('#contact-elements').empty();
                        data.contacts.forEach(function(contact) {
                          var contactElement = '<div class="relative flex items-center space-x-3 rounded-lg border border-gray-300 bg-white px-6 py-5 shadow-sm focus-within:ring-2 focus-within:ring-pink-500 focus-within:ring-offset-2 hover:border-gray-400">';
                         
                          contactElement += '<div class="flex-shrink-0">';      
                          contactElement += '<img class="h-10 w-10 rounded-full" src={% static 'images/user-circle-icon.png' %} alt="contact-picture">';         
                          contactElement += ' </div>';      
                          contactElement += '<div class="min-w-0 flex-1">';       
                          contactElement += '<a href="' + customerDetailUrl + contact.contact + '" class="focus:outline-none">';        
                          contactElement += '<span class="absolute inset-0" aria-hidden="true"></span>';           
                          contactElement += '<p class="text-sm font-medium text-gray-900">' + contact.contact_name + ' ' + contact.contact_last_name + '</p>';   
                          contactElement += '<p class="truncate text-sm text-gray-500">Relationship: ' + contact.relationship + '</p>';        
                          contactElement += '<p class="truncate text-sm text-gray-500">' + contact.contact_phone + '</p>';          
                          contactElement += '</a>';        
                          contactElement += '</div>';       
                          contactElement += '</div>';    

                         
                          $('#contact-elements').append(contactElement);
                          
                        });

                        
                        $('#service').empty();
                          var servicesElementDefault = '<option selected>-- Selet --</option>'
                          var servicesElement
                          data.services.forEach(function(service) {
                            servicesElement += ' <option value='+ service.id +'>' + service.name + '</option>'
                        });
                        $('#service').append(servicesElementDefault+servicesElement); 

                        $('#customer-document').empty();
                          var customerDocumentElementDefault = '<option selected>-- Selet --</option>'
                          var customerDocumentElement
                          data.documents.forEach(function(document) {
                            customerDocumentElement += ' <option value='+ document.id +'>' + document.document_name + '</option>'
                        });
                        $('#customer-document').append(customerDocumentElementDefault+customerDocumentElement); 

                         
                        var customer = ' <input type="text" class="hidden" name="customerId" value=' + customerId + '>'
                        $('#deal-form-fields').append(customer); 
                        $('#note-form-fields').append(customer); 
                        $('#customer-document-form-fields').append(customer); 
                        $('#customer-contact-form-fields').append(customer); 
                        $('#customer-new-text-message').append(customer); 
                        

                        
                        
                        $('#notification-elements').empty();
                        data.notifications.forEach(function(notification) {
                          var notificationElement = '<tr>';
                         
                          notificationElement += '<td class="hidden py-4 pl-6 pr-3 text-sm text-gray-500 lg:table-cell border-t border-gray-200">';       
                          notificationElement += '<svg viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">'; 
                          if (notification.channel == 'text'){
                             notificationElement += '<path fill-rule="evenodd" d="M4.804 21.644A6.707 6.707 0 0 0 6 21.75a6.721 6.721 0 0 0 3.583-1.029c.774.182 1.584.279 2.417.279 5.322 0 9.75-3.97 9.75-9 0-5.03-4.428-9-9.75-9s-9.75 3.97-9.75 9c0 2.409 1.025 4.587 2.674 6.192.232.226.277.428.254.543a3.73 3.73 0 0 1-.814 1.686.75.75 0 0 0 .44 1.223ZM8.25 10.875a1.125 1.125 0 1 0 0 2.25 1.125 1.125 0 0 0 0-2.25ZM10.875 12a1.125 1.125 0 1 1 2.25 0 1.125 1.125 0 0 1-2.25 0Zm4.875-1.125a1.125 1.125 0 1 0 0 2.25 1.125 1.125 0 0 0 0-2.25Z" clip-rule="evenodd" />';  
                          } else if (notification.channel == 'email'){
                              notificationElement += '<path d="M1.5 8.67v8.58a3 3 0 0 0 3 3h15a3 3 0 0 0 3-3V8.67l-8.928 5.493a3 3 0 0 1-3.144 0L1.5 8.67Z" />'
                              notificationElement += '<path d="M22.5 6.908V6.75a3 3 0 0 0-3-3h-15a3 3 0 0 0-3 3v.158l9.714 5.978a1.5 1.5 0 0 0 1.572 0L22.5 6.908Z" />'
                          } else {
                              notificationElement += ' <path fill-rule="evenodd" d="M1.5 4.5a3 3 0 0 1 3-3h1.372c.86 0 1.61.586 1.819 1.42l1.105 4.423a1.875 1.875 0 0 1-.694 1.955l-1.293.97c-.135.101-.164.249-.126.352a11.285 11.285 0 0 0 6.697 6.697c.103.038.25.009.352-.126l.97-1.293a1.875 1.875 0 0 1 1.955-.694l4.423 1.105c.834.209 1.42.959 1.42 1.82V19.5a3 3 0 0 1-3 3h-2.25C8.552 22.5 1.5 15.448 1.5 6.75V4.5Z" clip-rule="evenodd" />'
                          }
                          notificationElement += '</svg>';
                          notificationElement += '</td>';
                          notificationElement += '<td class="hidden px-3 py-3.5 text-sm text-gray-500 lg:table-cell border-t border-gray-200">';
                          notificationElement += '<div class="font-medium text-gray-900 pl-2">';
                          notificationElement += '<p>' + notification.text + '</p>';
                          notificationElement += '</div>';
                          notificationElement += '</td>';
                          notificationElement += '<td class="hidden px-3 py-3.5 text-sm text-gray-500 lg:table-cell border-t border-gray-200">' + notification.date + '</td>';
                          notificationElement += '<td class="hidden px-3 py-3.5 text-sm text-gray-500 lg:table-cell border-t border-gray-200">' + notification.sent_by + '</td>';
                          notificationElement += '</tr>';
                         
                          $('#notification-elements').append(notificationElement);
                          
                        });




                    },
                    error: function(error){
                        console.log('Error fetching customer details:', error);
                    }
                });
            });
        });

        function toggleSlideover(){
            document.getElementById('slideover-container').classList.toggle('invisible');
            document.getElementById('slideover-bg').classList.toggle('opacity-0');
            document.getElementById('slideover-bg').classList.toggle('opacity-50');
            document.getElementById('slideover').classList.toggle('translate-x-full');
        }

        function toggleModal(modalID){
            document.getElementById(modalID).classList.toggle("hidden");
            document.getElementById(modalID + "-backdrop").classList.toggle("hidden");
            document.getElementById(modalID).classList.toggle("flex");
            document.getElementById(modalID + "-backdrop").classList.toggle("flex");
        }

        function toggleSimpleModal(modalID){
            document.getElementById(modalID).classList.toggle("hidden");
            document.getElementById(modalID).classList.toggle("flex");
        }

        function openTab(evt, tabName) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
              tabcontent[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
             tablinks[i].className = tablinks[i].className.replace(" customer-tab-active", "");
            }
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.classList.add("customer-tab-active");
        }

        window.addEventListener("load", (event) => {
            const menulinks = document.getElementsByClassName("customer"); 
            
            for (i = 0; i < menulinks.length; i++) {
                    menulinks[i].className += " main-menu-selected";
                }
            // event.currentTarget.className += " tab-selected";
          
            tablinks = document.getElementsByClassName("tablinks");
            
            for (var i = 0; i < tablinks.length; i++) {
             tablinks[i].classList.add("customer-tab-active");
             break;
            }
            document.getElementById('datails').style.display = "block";
        });

        function mostrarCaracteres(textareaElement, contadorElement) {
            contadorElement.innerText = textareaElement.value.length;
        }

        document.addEventListener('DOMContentLoaded', function() {
            let contadorCaracteres = document.getElementById('contadorCaracteres');
            let textareaElement = document.getElementById('textareaCaracteres');

        mostrarCaracteres(textareaElement, contadorCaracteres);
            textareaElement.addEventListener('input', function() {
                mostrarCaracteres(textareaElement, contadorCaracteres);
            });
        });

      function calcularEdad(birthday) {
        if(birthday != '-' ){
            var birthday_arr = birthday.split("-");
            var birthday_date = new Date(birthday_arr[2], birthday_arr[0] - 1, birthday_arr[1]);
            var ageDifMs = Date.now() - birthday_date.getTime();
            var ageDate = new Date(ageDifMs);
            // Calculate the age
            return Math.abs(ageDate.getUTCFullYear() - 1970);
        } else {
          return "-"
        }
          
      }


        document.addEventListener('DOMContentLoaded', function () {
          var checkbox = document.querySelector('input[type="checkbox"]');

          checkbox.addEventListener('change', function () {
            if (checkbox.checked) {
                document.getElementById("address").classList.toggle("hidden");
              console.log('Checked');
            } else {
              document.getElementById("address").classList.toggle("hidden");
              console.log('Not checked');
            }
          });
        });
    </script>
{% endblock script %}